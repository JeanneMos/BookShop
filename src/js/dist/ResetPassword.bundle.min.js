"use strict";(self.webpackChunkespace_souvenir=self.webpackChunkespace_souvenir||[]).push([[547],{2816:function(e,r,n){n.d(r,{Z:function(){return i}});var t=n(5697),a=n.n(t),s=n(7294);function i(e){var r=e.children,n=e.type,t=void 0===n?"button":n,a=e.disabled,i=e.btnClass,l=e.onClickAction,u=e.dataTestid,o=e.ariaLabel;return s.createElement("button",{"data-testid":u,disabled:a,type:"submit"===t?"submit":"button",className:i,onClick:l,"aria-label":o||null},r)}i.defaultProps={type:"button",btnClass:null},i.propTypes={type:a().string,children:a().node.isRequired,btnClass:a().string}},1325:function(e,r,n){var t=n(4184),a=n.n(t),s=n(7294),i=n(7762),l=n(1295),u=s.memo((function(e){var r=e.id,n=e.name,t=e.imageName,u=e.labelText,o=e.labelImage,c=e.type,d=e.value,m=e.autocomplete,p=e.min,f=e.max,v=e.checked,w=e.inputClass,h=e.wrapperClass,g=e.onInputChange,b=e.onInputBlur,E=e.inputPlaceholder,_=e.error,y=e.displayErrorMessage,N=void 0===y||y,Z=e.isRequired,C=e.disabled,k=e.readOnly,O=void 0!==k&&k,q=e.ariaDescription,P=encodeURIComponent((0,i.renderToStaticMarkup)(s.createElement(l.default,{name:"cross-red",iconClass:"input-error-icon"}))),S='url("data:image/svg+xml,'.concat(P,'")'),j=!Z&&s.createElement("span",{className:"optional-label"}," (facultatif)");return s.createElement("div",{className:a()("input-wrapper",h)},!o&&"checkbox"!==c&&s.createElement("label",{htmlFor:r,className:a()("label",{"label-error":_})},u,j),s.createElement("input",{id:r,type:c,name:n,readOnly:O,"data-imagename":t,className:a()("input",{"input-error":_,inputClass:w}),style:{backgroundImage:_?S:"none"},value:d,min:p,autoComplete:m||null,maxLength:f||null,disabled:C,required:Z,"aria-required":Z,"aria-describedby":_?"error-".concat(r," ").concat(q):q,"aria-invalid":!!_&&"true",onChange:g,onBlur:b,checked:"radio"===c?v:null,placeholder:E||""}),o&&s.createElement("label",{htmlFor:r,className:a()("label",{"label-error":_})},s.createElement("img",{src:o,className:"label-image",alt:"",width:"150"})),"checkbox"===c&&s.createElement("label",{htmlFor:r,className:a()("label",{"label-error":_})},u),_&&N&&s.createElement("p",{className:"error-message",id:"error-".concat(r),"aria-live":"polite"},_))}));r.Z=u},2558:function(e,r,n){n.d(r,{Z:function(){return c}});var t=n(7294),a=n(4184),s=n.n(a),i=n(1295),l={patternNumber:"Il manque un chiffre",patternLength:"Le mot de passe n'est pas assez long",patternMaj:"Il manque une majuscule",patternSpecialChar:"Il manque un caractère spécial"};function u(e){var r=e.isValid,n=e.error;return t.createElement("span",null,t.createElement(i.default,{name:r?"check":"cross",iconClass:s()("password-validation-icon",r?"green":"red")}),n&&t.createElement("span",{className:"sr-only"},l[n]))}var o=n(1325);function c(e){var r=e.inputValues,n=e.changeHandler,a=e.errorHandler,s=e.errors,i=e.includeCurrentPassword,l=void 0!==i&&i,c=e.requiredNewPassword,d=void 0!==c&&c,m=function(e){var n;return""===r.new_password?null:null!=s&&s.new_password&&0!==(null==s||null===(n=s.new_password)||void 0===n?void 0:n.length)?t.createElement(u,{isValid:!s.new_password.includes(e),error:s.new_password.includes(e)&&e}):t.createElement(u,{isValid:!0})};return t.createElement(t.Fragment,null,l&&t.createElement(o.Z,{id:"current_password",name:"current_password",labelText:"Mot de passe actuel",type:"password",autocomplete:"current-password",value:r.current_password,inputPlaceholder:"Mot de passe actuel",onInputChange:n,onInputBlur:a,error:s.current_password}),t.createElement(o.Z,{id:"new_password",name:"new_password",labelText:"Nouveau mot de passe",type:"password",autocomplete:"new-password",value:r.new_password,inputPlaceholder:"Nouveau mot de passe",onInputChange:function(e){a(e),n(e)},onInputBlur:a,displayErrorMessage:!1,isRequired:d,error:s.new_password,ariaDescription:"new_password_requirement"}),t.createElement(o.Z,{id:"repeat_new_password",name:"repeat_new_password",labelText:"Confirmer votre mot de passe",type:"password",value:r.repeat_new_password,inputPlaceholder:"Confirmer votre mot de passe",onInputChange:n,onInputBlur:a,isRequired:d,error:s.repeat_new_password}),t.createElement("span",{className:"sr-only",id:"new_password_requirement"},"l faut un minimum de 8 caractères avec au moins une majuscule, un chiffre et un caractère spécial."),t.createElement("p",{className:"password-check","aria-live":"polite",id:"error-new_password","aria-relevant":"additions"},t.createElement("span",{"aria-hidden":"true"},"Il faut un minimum de "),t.createElement("span",{className:"password-check-item"},t.createElement("span",{"aria-hidden":"true"},"8 caractères avec au moins")," ",m("patternLength")),t.createElement("span",{className:"password-check-item"},t.createElement("span",{"aria-hidden":"true"},"1 majuscule")," ",m("patternMaj")),t.createElement("span",{className:"password-check-item"},t.createElement("span",{"aria-hidden":"true"},"1 chiffre")," ",m("patternNumber")),t.createElement("span",{className:"password-check-item"},t.createElement("span",{"aria-hidden":"true"},"1 caractère spécial")," ",m("patternSpecialChar"))))}},2849:function(e,r,n){n.d(r,{A8:function(){return p},BN:function(){return s},Bn:function(){return f},C_:function(){return _},Gn:function(){return o},Il:function(){return t},JT:function(){return c},ML:function(){return w},Mm:function(){return E},Nn:function(){return O},Qd:function(){return a},Qo:function(){return Z},Qv:function(){return C},Qy:function(){return N},R$:function(){return m},Th:function(){return l},Ti:function(){return i},Y_:function(){return d},hZ:function(){return y},j5:function(){return v},jU:function(){return q},r2:function(){return b},rG:function(){return g},sY:function(){return k},ts:function(){return u},u1:function(){return h}});var t=649,a=6e5,s=8,i="https://jsonplaceholder.typicode.com/posts",l="/es/get-menu/footer",u="/es/get-current-user",o="/es/get-espace-entity",c="/es/get-messages",d="/es/get-number-message",m="/es/entity-save-field",p="/es/message-save-field",f="/es/get-user",v="/es/user-update",w="/es/message/create",h="/es/user/reset-password",g="field_es_homage",b="field_es_bio",E="field_es_profile_image",_="status",y="messagesAccueil",N="messagesList",Z="numberMessages",C="accueil",k="messages",O="biographie",q="<br />"},1935:function(e,r,n){n.d(r,{Z:function(){return i}});var t=n(4184),a=n.n(t),s=n(7294);function i(e){var r=e.position,n=e.children,t=e.btnWrapperClass;return s.createElement("div",{className:a()("buttons-wrapper",r,t)},n)}},4698:function(e,r,n){n.d(r,{Z:function(){return _}});var t=n(5697),a=n.n(t),s=n(7294),i=n(5998),l=n(9711);var u=function(e){var r=e.data,n=e.isFetching,t=e.error;return s.createElement("footer",null,n?"Fetching":null,isNaN(r)||t&&s.createElement("p",{className:"fetch-error-message"},"Nous avons rencontré une erreur, merci de réessayer plus tard"),r&&r.length&&s.createElement("ul",{className:"footer-nav","data-testid":"footerFetchedLinks"},r.map((function(e){return s.createElement("li",{key:e.title},s.createElement(l.rU,{to:e.url},e.title))}))),s.createElement(l.rU,{to:"/main-page/1",style:{marginLeft:"15px"}},"Contenu du ES"))},o=n(6974),c=n(2849),d=n(9973),m=n(2791),p=n(1363),f=n(1628);function v(){return s.createElement("div",{className:"loader-login"},s.createElement("svg",{"aria-hidden":"true",width:"26",height:"30",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 27 32"},s.createElement("path",{d:"m5.495 17.895 2.161-.999a7.773 7.773 0 0 0 1.81-1.116l.21-.176.227.152a6.203 6.203 0 0 0 6.962 0l.218-.147.209.162a9.29 9.29 0 0 0 1.817 1.125l2.166 1c2.593 1.193 4.27 3.825 4.27 6.705v4.195h-.096c-.177 1.09-1.11 1.925-2.232 1.925H3.484c-1.247 0-2.261-1.032-2.261-2.301v-3.819c0-2.88 1.677-5.512 4.272-6.706m1.912-9.498c0-3.944 2.666-7.152 5.944-7.152 3.277 0 5.945 3.208 5.945 7.152s-2.668 7.154-5.945 7.154c-3.278 0-5.944-3.21-5.944-7.154M0 24.601v3.854C0 30.409 1.563 32 3.484 32h19.733c1.902 0 3.45-1.59 3.45-3.545V24.6c.032-3.369-1.912-6.448-4.952-7.845l-2.164-.999a5.23 5.23 0 0 1-1.227-.736l-.307-.25.266-.296c1.42-1.584 2.234-3.799 2.234-6.078C20.517 3.768 17.301 0 13.351 0 9.4.033 6.184 3.815 6.184 8.432c0 2.315.793 4.473 2.233 6.076l.28.31-.334.247c-.412.306-.82.527-1.2.72L4.988 16.79C1.958 18.15 0 21.216 0 24.601",fill:"#696969",fillRule:"evenodd"})),s.createElement("span",{"aria-hidden":!0,className:"user-login-connexion"},"Se connecter"),s.createElement("span",{className:"sr-only"},"Patientez"))}function w(){return s.createElement(l.rU,{to:"/",className:"banner-link","data-testid":"bannerLink"},"Espace Souvenirs")}var h=s.lazy((function(){return Promise.all([n.e(835),n.e(120)]).then(n.bind(n,4926))})),g=s.lazy((function(){return Promise.all([n.e(835),n.e(387)]).then(n.bind(n,1561))}));function b(){var e=(0,i.v9)((function(e){return e.administrator})),r=(0,i.I0)(),n=(0,o.UO)().espaceId,t=(0,f.Z)({key:"current-user",API:c.ts,staleTime:1e4,cacheTime:1/0}),a=t.data,l=t.isFetching;t.error;return(0,s.useEffect)((function(){if(a&&null!=a&&a.field_user_email){r((0,d.nD)());var e=a.field_user_surname,t=a.field_user_name,s=a.field_user_phone,i=a.field_user_email,l=a.field_user_civility,u=a.user_gp_entity,o={lastName:e,firstName:t,phone:s,email:i,civility:l,gp_entities:u},c=(0,p.B)(u).includes(n);(0,p.B)(u).length&&r((0,d.Vy)({isAdmin:c})),r((0,d.n0)({user:o}))}else r((0,d.n0)({user:null})),r((0,d.Vy)({isAdmin:!1})),r((0,d._e)())}),[a]),s.createElement("header",null,s.createElement(w,null),l&&s.createElement(v,null),!l&&e.isLogged&&s.createElement(s.Suspense,{fallback:s.createElement("p",null,"attendez...")},s.createElement(h,null)),!l&&!e.isLogged&&s.createElement(s.Suspense,{fallback:s.createElement("p",null,"attendez...")},s.createElement(g,{handleLogIn:function(){r((0,m.bz)({theme:"dark",hasCloseButton:!0,modalType:"LoginModal"}))}})))}var E=s.lazy((function(){return Promise.all([n.e(154),n.e(111),n.e(5),n.e(597),n.e(835),n.e(711),n.e(896)]).then(n.bind(n,9532))}));function _(e){var r=e.children,n=(0,i.v9)((function(e){return e.modal})),t=(0,f.Z)({key:"footer",API:c.Th,staleTime:3e5,cacheTime:1/0}),a=t.data,l=t.error,o=t.isFetching;return s.createElement(s.Fragment,null,s.createElement(b,null),s.createElement("main",null,r),s.createElement(u,{data:a,error:l,isFetching:o}),n.isOpen&&s.createElement(E,{theme:n.theme}))}_.propTypes={children:a().node.isRequired}},71:function(e,r,n){n.r(r),n.d(r,{default:function(){return h}});var t=n(7294),a=n(2982),s=n(885),i=n(1935),l=n(7959),u=n(6006),o=n(5320),c=n(2816),d=n(1295),m=n(2558),p={repeat_new_password:{isRequired:!0,required:"Merci de confirmer le mot de passe"},new_password:{isRequired:!0,required:"Merci de renseigner le mot de passe",patterns:[{name:"patternNumber",value:/[0-9]/},{name:"patternLength",value:/^[\s\S]{8,}$/},{name:"patternMaj",value:/[A-Z]/},{name:"patternSpecialChar",value:/[ !"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]/}]}},f={new_password:"",repeat_new_password:""};function v(){var e=(0,t.useState)(!1),r=(0,s.Z)(e,2),n=(r[0],r[1]),v=(0,t.useState)(null),w=(0,s.Z)(v,2),h=w[0],g=w[1],b=(0,t.useRef)(),E=(0,t.useRef)(),_=(0,o.Z)(),y=(0,u.Z)({initialFormState:f,validationValues:p}),N=y.inputValues,Z=y.changeHandler,C=y.errorHandler,k=y.submitErrorsHandler,O=y.errors,q=y.isValid;return t.createElement("form",{noValidate:!0,onSubmit:function(e){e.preventDefault();var r=Object.keys(O);if(!q&&b.current&&(0,l.Z)(b.current),0===r.length){var t=Object.entries(N).filter((function(e){var r=(0,s.Z)(e,2),n=r[0],t=r[1];return p[n].isRequired&&""===t})).map((function(e){return(0,s.Z)(e,1)[0]}));if(t.length)k(t);else if(""!==N.new_password&&""===N.repeat_new_password)k([].concat((0,a.Z)(t),[{name:"repeat_new_password",requiredMessage:"Merci de confirmer votre mot de passe"}]));else if(""!==N.new_password&&N.repeat_new_password!==N.new_password)k([].concat((0,a.Z)(t),[{name:"repeat_new_password",requiredMessage:"Les mots de passes ne sont pas identiques"}]));else if(""!==N.new_password&&""===N.current_password)k([].concat((0,a.Z)(t),[{name:"current_password",requiredMessage:"Merci de confirmer votre mot de passe actuel"}]));else{var i={new_password:N.new_password,repeat_new_password:N.repeat_new_password};try{n(!0),_.mutate({data:i,apiUrl:"///////"},{onSuccess:function(e){e.data},onError:function(){n(!1)}})}catch(e){n(!1),g("Une erreur s'est produite. Veuillez reprendre ultérieurement."),(null==h?void 0:h.current)&&(0,l.Z)(h.current)}}}},className:"reset-password-form"},t.createElement("p",null,"Bienvenue,"),t.createElement("p",null,"Vous pouvez désormais vous connecter à votre Espace Souvenirs."),t.createElement("p",null,"Personnaliser votre mot de passe pour vos prochaines connexions."),h&&t.createElement("p",{ref:E,className:"message-status mb-40"},t.createElement(d.default,{name:"cross",iconClass:"message-status-icon error-icon"}),t.createElement("span",null,h)),!q&&t.createElement("p",{className:"sr-only",tabIndex:0,ref:b},"Merci de corriger les erreurs"),t.createElement("fieldset",{className:"mt-30"},t.createElement(m.Z,{inputValues:N,changeHandler:Z,errorHandler:C,requiredNewPassword:!0,errors:O})),t.createElement(i.Z,{position:"mt-30"},t.createElement(c.Z,{type:"submit",btnClass:"bg-current"},t.createElement("span",{className:"button-text"},"accéder à l'espace souvenirs"),t.createElement("span",{className:"separator"}," "),t.createElement(d.default,{name:"next",iconClass:"white-icon"}))))}var w=n(4698);function h(){return(0,t.useEffect)((function(){document.title="Nouveau mot de passe",(0,l.Z)()}),[]),t.createElement(w.Z,null,t.createElement("div",{className:"reset-password-wrapper"},t.createElement(v,null)))}},1363:function(e,r,n){n.d(r,{B:function(){return t}});var t=function(e){return e||[]}},7959:function(e,r,n){function t(e){e&&e.focus({preventScroll:!0}),window.scrollTo({top:(null==e?void 0:e.offsetTop)||0,behavior:"smooth"})}n.d(r,{Z:function(){return t}})},6006:function(e,r,n){n.d(r,{Z:function(){return d}});var t=n(1002),a=n(4925),s=n(4942),i=n(885),l=n(7294);function u(e){var r=function(e,r){if("object"!==(0,t.Z)(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var a=n.call(e,r||"default");if("object"!==(0,t.Z)(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===(0,t.Z)(r)?r:String(r)}function o(e,r){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);r&&(t=t.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),n.push.apply(n,t)}return n}function c(e){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?o(Object(n),!0).forEach((function(r){(0,s.Z)(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function d(e){var r=e.initialFormState,n=e.validationValues,t=(0,l.useState)(r),o=(0,i.Z)(t,2),d=o[0],m=o[1],p=(0,l.useState)({}),f=(0,i.Z)(p,2),v=f[0],w=f[1],h=(0,l.useState)(!0),g=(0,i.Z)(h,2),b=g[0],E=g[1],_=function(e){if(""!==e.value){var r=n[e.name].pattern,t=n[e.name].patterns;if(null!=r&&r.value&&!RegExp(r.value).test(e.value))return null==r?void 0:r.message;if(t){var a=t.map((function(r){if(r.value&&!RegExp(r.value).test(e.value))return r.name})),s=a.filter((function(e){return!!e}));return s.length?s:null}return null}return null!==e.getAttribute("required")&&""===e.value?n[e.name].required:null};return{inputValues:d,changeHandler:function(e){var r=e.target,n=c(c({},d),{},(0,s.Z)({},r.name,r.value));if(!_(r)&&Object.prototype.hasOwnProperty.call(v,r.name)){var t=r.name,i=(v[t],(0,a.Z)(v,[t].map(u)));w(i)}0===Object.keys(v).length&&E(!0),m(n)},errorHandler:function(e){var r=e.target,n={};_(r)?(E(!1),n=c(c({},v),{},(0,s.Z)({},r.name,_(r)))):n=c({},v),w(n)},submitErrorsHandler:function(e){var r={},t=null;e.forEach((function(e){var a;e.requiredMessage?t=e.requiredMessage:t=null===(a=n[e])||void 0===a?void 0:a.required;e.requiredMessage?r[e.name]=t:r[e]=t})),E(!1),w(r)},errors:v,isValid:b}}},1628:function(e,r,n){n.d(r,{Z:function(){return o}});var t=n(5861),a=n(7757),s=n.n(a),i=n(9669),l=n.n(i),u=(n(7294),n(8767));function o(e){var r=e.key,n=e.API,a=e.staleTime,i=void 0===a?0:a,o=e.cacheTime,c=void 0===o?0:o,d=e.refetchOnMount,m=void 0!==d&&d,p=e.refetchOnWindowFocus,f=void 0!==p&&p,v=e.enabled,w=void 0===v||v;return(0,u.useQuery)(r,(0,t.Z)(s().mark((function e(){var r,t,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l().get(n);case 3:return r=e.sent,e.next=6,null==r?void 0:r.data;case 6:return t=e.sent,e.abrupt("return",t);case 10:return e.prev=10,e.t0=e.catch(0),e.abrupt("return",{error:!0,status:null===e.t0||void 0===e.t0||null===(a=e.t0.response)||void 0===a?void 0:a.status});case 13:case"end":return e.stop()}}),e,null,[[0,10]])}))),{staleTime:i,cacheTime:c,refetchOnMount:m,refetchOnWindowFocus:f,enabled:w})}},5320:function(e,r,n){var t=n(9669),a=n.n(t),s=(n(7294),n(8767)),i={headers:{"Content-Type":"application/json"},withCredentials:!0,credentials:"include"};r.Z=function(e){var r=(0,s.useMutation)((function(r){var n=r.data,t=r.apiUrl,s=r.options,l=void 0===s?e||i:s;return a().post(t,n,l)})),n=r.data,t=r.error,l=(r.isError,r.isIdle,r.isLoading),u=(r.isPaused,r.isSuccess),o=r.mutate;r.mutateAsync,r.reset,r.status;return{mutate:o,isSuccess:u,data:n,isLoading:l,error:t}}}}]);