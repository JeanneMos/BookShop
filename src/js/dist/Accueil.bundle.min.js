"use strict";(self.webpackChunkespace_souvenir=self.webpackChunkespace_souvenir||[]).push([[715],{6993:function(e,a,t){t.r(a),t.d(a,{default:function(){return _}});var n=t(7294),l=t(5998),s=t(324),r=t(1295),c=t(8954);function i(){var e=(0,l.v9)((function(e){return e.globalInfo}));if(null==e||!e.agency||(0,s.yD)(null==e?void 0:e.agency))return null;var a=e.agency,t=a.agency_name,i=a.agency_address,m=a.agency_postal_code,o=a.agency_town,u=a.agency_phone,d=a.agency_url;return n.createElement("div",{className:"accueil-agency-wrapper"},n.createElement("div",{className:"agency-wrapper","data-testid":"agencyWrapper"},n.createElement("h2",{className:"content-heading-2"},"L'agence organisatrice"),n.createElement("div",{className:"agency-infos"},n.createElement("p",{className:"agency-title"},t),n.createElement("p",{className:"agency-address"},i),n.createElement("p",{className:"agency-zipcode"},m," ",o),n.createElement("div",{className:"agency-contact"},u&&n.createElement("p",{className:"agency-phone","data-testid":"agencyPhone"},n.createElement("span",null,"Tel: "),n.createElement("span",{className:"sr-only"},"téléphone"),n.createElement(c.Z,{as:"ahref",linkTo:"tel:".concat(u),linkClass:"bg-transparent agency-phone-link"},u)),d&&n.createElement(c.Z,{as:"ahref",linkTo:d,linkClass:"link bg-current",dataTestid:"agencyCta",target:"_blank"},n.createElement("span",{className:"link-text"},"Fiche agence"),n.createElement("span",{className:"separator"}," "),n.createElement(r.default,{name:"next",iconClass:"white-icon"}))))))}var m=n.memo((function(e){var a,t,i,m=e.ceremony,o=m.adresse,u=m.codepostal,d=m.commune,p=m.adresse2,g=m.datelieu,v=m.nom,E=(m.pays,m.type),f=(m.availability,(0,l.v9)((function(e){return e.globalInfo}))),y=(0,n.useMemo)((function(){if(g)return(0,s.HJ)((0,s.eQ)(g))}),[g]);return n.createElement("li",null,n.createElement("span",{className:"ceremony-place-icon"},n.createElement(r.default,{name:"anneau",iconClass:"anneau-icon"})),g&&n.createElement("p",{className:"ceremony-date"},n.createElement("span",{className:"ceremony-hour"},y),n.createElement("span",null,(0,s.eQ)(g).toLocaleDateString("fr"))),n.createElement("div",{className:"ceremony-place"},E&&n.createElement("p",{className:"ceremony-type"},E),n.createElement("div",{className:"ceremony-description-link"},n.createElement("p",{className:"ceremony-description"},y&&"Aura lieu à ".concat(y),v&&" à ".concat(v)),(null==f||null===(a=f.marque)||void 0===a?void 0:a.urlBoutique)&&(null==f||null===(t=f.obituary)||void 0===t?void 0:t.fleursAutorise)&&n.createElement(c.Z,{as:"ahref",linkTo:null==f||null===(i=f.marque)||void 0===i?void 0:i.urlBoutique,linkClass:"link bg-white boutique-link",dataTestid:"boutiqueCta",target:"_blank"},n.createElement("span",{className:"link-text"},"offrir des fleurs"),n.createElement("span",{className:"separator"}," "),n.createElement(r.default,{name:"next",iconClass:"current-icon"}))),n.createElement("div",{className:"ceremony-name-address"},n.createElement(r.default,{name:"geoloc",iconClass:"geoloc-icon"}),n.createElement("div",null,n.createElement("p",{className:"ceremony-name"},n.createElement("span",null,v)),n.createElement("p",{className:"ceremony-address"},o&&n.createElement("span",null,o),p&&n.createElement("span",null,p),n.createElement("br",null),u&&n.createElement("span",{className:"mr-5"},u),d&&n.createElement("span",null,d))))))}));function o(){var e,a,t,s,r,c=(0,l.v9)((function(e){return e.globalInfo}));return null!=c&&null!==(e=c.obituary)&&void 0!==e&&e.ceremonies&&(null==c||null===(a=c.obituary)||void 0===a?void 0:a.ceremonies.length)>0?n.createElement("div",{className:"accueil-ceremonies-wrapper"},n.createElement("h2",{className:"content-heading-2","data-testid":"ceremonies"},"Cérémonie"),(null==c||null===(t=c.agency)||void 0===t?void 0:t.agency_name)&&n.createElement("p",{className:"ceremonies-agency"},n.createElement("span",null,"Cet hommage est organisé par l’agence"," ",null==c||null===(s=c.agency)||void 0===s?void 0:s.agency_name),n.createElement("span",{className:"ceremony-agency-separator"}),n.createElement("span",null,"ICI LOGO")),n.createElement("div",{className:"ceremonies-wrapper"},n.createElement("ul",{className:"ceremonies-list","data-testid":"ceremonies-list"},null==c||null===(r=c.obituary)||void 0===r?void 0:r.ceremonies.map((function(e){return n.createElement(m,{key:e.datelieu,ceremony:e})}))))):null}function u(e){var a,t,l,i,m=e.prestation,o=m.field_prest_titre,u=m.field_prest_image,d=m.field_prest_description,p=m.field_prest_url;return n.createElement("article",{className:"transversal-item"},(null==u||null===(a=u.field_media_image)||void 0===a?void 0:a.url)&&n.createElement("div",{className:"transversal-image-wrapper"},n.createElement("picture",null,n.createElement("source",{srcSet:null==u||null===(t=u.field_media_image)||void 0===t?void 0:t.url,media:"(min-width: 650px)"}),n.createElement("img",{className:"transversal-image",loading:"lazy",src:null==u||null===(l=u.field_media_image)||void 0===l?void 0:l.url,alt:"",width:"452",height:"250"}))),n.createElement("div",{className:"transversal-content"},n.createElement("h3",{className:"title-underlined"},o),n.createElement("p",null,(0,s.SQ)((0,s.iU)(d))),n.createElement(c.Z,{as:"ahref",linkTo:null==p?void 0:p.url,target:null!=p&&null!==(i=p.attributes)&&void 0!==i&&i.external?"_blank":null,linkClass:"link bg-current"},n.createElement("span",{className:"link-text"},null==p?void 0:p.title),n.createElement("span",{className:"separator"}," "),n.createElement(r.default,{name:"next",iconClass:"white-icon"}))))}function d(){var e,a=(0,l.v9)((function(e){return e.globalInfo}));return a.prestations&&0!==(null===(e=a.prestations)||void 0===e?void 0:e.length)?n.createElement("div",{className:"transversal-blocks","data-testid":"transversalBlocks"},a.prestations.map((function(e){return n.createElement(u,{key:e.field_prest_titre,prestation:e})}))):null}var p=t(2791),g=t(2816);function v(){var e=(0,l.v9)((function(e){return e.globalInfo})),a=(0,l.v9)((function(e){return e.administrator})),t=(0,l.I0)();return a.isAdmin?n.createElement("div",{className:"homage-wrapper","data-testid":"homage"},n.createElement("div",{className:"heading-button-wrapper"},n.createElement("h2",{className:"content-heading-2"},"Rendre Hommage"),n.createElement(g.Z,{type:"button",btnClass:"edit-text-button bg-current",onClickAction:function(){t((0,p.bz)({theme:"dark",hasCloseButton:!0,modalType:"HomageModal"}))}},n.createElement(r.default,{name:"pencil",iconClass:"edit-text-icon"}))),n.createElement("div",{className:"content-homage"},(0,s.SQ)((0,s.iU)(null==e?void 0:e.homageText)))):!a.isAdmin&&null!=e&&e.homageText?n.createElement("div",{className:"homage-wrapper"},n.createElement("div",{className:"heading-button-wrapper"},n.createElement("h2",{className:"content-heading-2"},"Rendre Hommage")),n.createElement("div",{className:"content-homage"},(0,s.SQ)((0,s.iU)(null==e?void 0:e.homageText)))):null}var E=t(2849),f=t(1887);function y(e){var a=e.handleActiveTab;return n.createElement("div",{className:"accueil-messages-wrapper"},n.createElement("div",{className:"heading-button-wrapper between"},n.createElement("h2",{className:"content-heading-2"},"Derniers messages"),n.createElement(g.Z,{type:"button",btnClass:"bg-current",onClickAction:function(){a(E.sY)}},n.createElement("span",{className:"button-text"},"Voir les messages"),n.createElement("span",{className:"separator"}," "),n.createElement(r.default,{name:"next",iconClass:"white-icon"}))),n.createElement(f.Z,{page:"accueil"}))}var h=t(3607);t(1480);function b(){var e,a,t,i,m,o,u,d,p,g,v,E,f,y,b,N,_=(0,l.v9)((function(e){return e.globalInfo}));return null!=_&&_.obituary?n.createElement("div",{className:"accueil-obituary-wrapper","data-testid":"obituary"},n.createElement("h2",{className:"content-heading-2"},"Avis de décès"),n.createElement("div",{className:"obituary-wrapper"},n.createElement("div",{className:"obituary-content-wrapper"},n.createElement("div",{className:"obituary-photo"},n.createElement("div",{className:"image-preview"},n.createElement("img",{alt:"",className:"image-preview-image",width:"200",height:"200","data-testid":"obituary-photo",src:null!=_&&null!==(e=_.obituary)&&void 0!==e&&null!==(a=e.photo)&&void 0!==a&&a.length?null==_||null===(t=_.obituary)||void 0===t||null===(i=t.photo)||void 0===i?void 0:i.url:h.Z}))),n.createElement("div",{className:"obituary-content"},n.createElement("div",{className:"obituary-description"},n.createElement("p",{className:"obituary-name"},null==_||null===(m=_.obituary)||void 0===m?void 0:m.civility," ",n.createElement("span",{className:"info-firstname"},null==_||null===(o=_.obituary)||void 0===o?void 0:o.firstName)," ",n.createElement("span",{className:"info-lastname"},null==_||null===(u=_.obituary)||void 0===u?void 0:u.lastName),(null==_||null===(d=_.obituary)||void 0===d?void 0:d.maidenName)&&n.createElement("span",{className:"d-block"},"né(e) ",n.createElement("span",{className:"info-lastname"},null==_||null===(p=_.obituary)||void 0===p?void 0:p.maidenName))),n.createElement("p",{className:"obituary-place"},null==_||null===(g=_.obituary)||void 0===g?void 0:g.city," (",null==_||null===(v=_.obituary)||void 0===v||null===(E=v.zipCode)||void 0===E?void 0:E.slice(0,2),")"),n.createElement("p",{className:"obituary-publication"},null==_||null===(f=_.obituary)||void 0===f?void 0:f.publicationStatus," ",(0,s.vc)(new Date(null==_||null===(y=_.obituary)||void 0===y?void 0:y.publicationDate)))),function(){if(null==_||!_.agency)return null;if(null!=_&&_.agency){var e=_.agency,a=e.agency_marque,t=e.agency_town,l=e.agency_postal_code;return n.createElement("div",{className:"obituary-agency","data-testid":"obituary-agency"},a," ",t," (",null==l?void 0:l.slice(0,2),")")}}(),(null==_||null===(b=_.obituary)||void 0===b?void 0:b.urlAvis)&&n.createElement("div",{className:"obituary-links"},n.createElement(c.Z,{as:"ahref",linkTo:null==_||null===(N=_.obituary)||void 0===N?void 0:N.urlAvis,linkClass:"link bg-white",dataTestid:"avisCta",target:"_blank"},n.createElement("span",{className:"link-text"},"détail"),n.createElement("span",{className:"separator"}," "),n.createElement(r.default,{name:"next",iconClass:"current-icon"}))))))):null}var N=t(5376);function _(e){var a=e.name,t=e.handleActiveTab;return n.createElement(N.Z,{name:a},n.createElement(v,null),n.createElement(o,null),n.createElement(d,null),n.createElement(y,{handleActiveTab:t}),n.createElement(b,null),n.createElement(i,null))}},1887:function(e,a,t){t.d(a,{Z:function(){return O}});var n=t(4942),l=t(885),s=t(7294),r=t(5998),c=t(6974),i=t(2849),m=t(4470),o=t(1628),u=t(1295),d=t(6578);function p(){return s.createElement("div",{className:"messages-wrapper"},s.createElement("p",{className:"messages-empty-text","data-testid":"emptyMessageList"},"Il n'y a pas encore de messages sur cet Espace Souvenirs"))}var g=t(4184),v=t.n(g),E=t(1935),f=t(324),y=t(5320),h=t(2816),b=t(8954);function N(e){var a=e.email,t=e.subject,n=t?"?subject=".concat(t):null;return s.createElement(b.Z,{as:"ahref",linkTo:"mailto:".concat(a).concat(n),linkClass:"link bg-transparent"},s.createElement(u.default,{name:"envelope",iconClass:"current-icon envelope-icon"}),s.createElement("span",{className:"separator"}," "),s.createElement("span",{className:"link-text"},"Répondre"))}function _(e){var a=e.isLoading,t=e.handleSwitch,n=e.messageId,l=e.isChecked;return s.createElement("div",{className:v()("switch-wrapper",a&&"loading-status")},s.createElement("span",null,l?"Publié":"Dépublié"),s.createElement("label",{className:"switch","data-testid":"switchCheck"},s.createElement("input",{disabled:a,type:"checkbox",checked:l,onChange:function(){t(n)}}),s.createElement("span",{className:"slider"})))}function w(){return s.createElement("span",{className:"new-message-tag"},"nouveau")}var k=s.memo((function(e){var a,t,n=e.message,c=n.field_message_surname,m=n.field_message_name,o=n.field_message_date_created,u=n.field_message_texte,d=n.field_message_email,p=n.field_message_photo,g=n.field_message_status,b=n.field_message_banner,k=n.isNew,C=n.message_id,Z=(0,r.v9)((function(e){return e.globalInfo})),A=(0,r.v9)((function(e){return e.administrator})),x=(0,y.Z)(),T=(0,s.useState)(!1),O=(0,l.Z)(T,2),I=O[0],S=O[1],P=(0,s.useState)(g),Q=(0,l.Z)(P,2),j=Q[0],L=Q[1],D=(0,s.useRef)(null),q=(0,s.useRef)(null),z=(0,s.useMemo)((function(){if(o)return(0,f.NE)((0,f.eQ)(o))}),[o]),M="Merci pour votre message en hommage à ".concat((0,f.lF)(null==Z||null===(a=Z.defunt)||void 0===a?void 0:a.firstName)||""," ").concat(null==Z||null===(t=Z.defunt)||void 0===t?void 0:t.lastName);return(0,s.useEffect)((function(){D.current&&q.current&&(D.current.clientHeight>q.current.clientHeight?S(!1):S(!0))}),[]),s.createElement("li",{className:v()("message-item",{"message-item-long":p||b})},k&&s.createElement(w,null),p&&s.createElement("div",{className:"message-item-image-wrapper"},s.createElement("img",{alt:"",className:"message-item-image",loading:"lazy",src:function(e){return"string"==typeof e?e[0]:e[0].url}(p)})),b&&s.createElement("div",{className:"message-item-image-wrapper"},s.createElement("img",{alt:"",className:"message-item-image",loading:"lazy",src:function(e){return"".concat(window.location.origin,"/themes/custom/souvenirs/src/assets/images/bg-images/").concat(e)}(b)})),s.createElement("div",{className:v()("message-author",{"mt-50":!p,"mt-20":p})},s.createElement("p",{"data-testid":"writtenby-message"},"Ecrit par ",s.createElement("span",{className:"info-firstname"},m)," ",s.createElement("span",{className:"info-lastname"},c)),s.createElement("p",null,z)),u&&s.createElement("div",{ref:q,className:v()("message-body",{open:I})},s.createElement("p",{ref:D},(0,f.SQ)(u))),!I&&s.createElement(E.Z,null,s.createElement(h.Z,{type:"button",onClickAction:function(){S(!0)},btnClass:"bg-transparent"},"Lire la suite",s.createElement("span",{className:"sr-only"},"du message envoyé par ",m," ",c))),(null==A?void 0:A.isAdmin)&&s.createElement(E.Z,{position:"space-between"},s.createElement(_,{isLoading:x.isLoading,handleSwitch:function(){var e={field_value:!j,field_machine_name:i.C_,message_id:C};try{x.mutate({data:e,apiUrl:i.A8},{onSuccess:function(e){var a=e.data;L(null==a?void 0:a.field_value)}})}catch(e){L(g)}},messageId:o,isChecked:j}),s.createElement(N,{email:d,subject:M})))})),C=t(2982),Z=t(8767);function A(e){var a=e.messages,t=(0,r.I0)(),n=((0,Z.useQueryClient)(),(0,r.v9)((function(e){return e.messages}))),c=n.messagesViewed.length?n.messagesViewed:(0,f.yQ)(a,0,i.BN),o=(0,s.useState)(c),d=(0,l.Z)(o,2),p=d[0],g=d[1];return s.createElement("div",{className:"messages-wrapper"},s.createElement("ul",{className:"messages-list","data-testid":"messagesWithPaginationList"},p.map((function(e){return s.createElement(k,{key:null==e?void 0:e.message_id,message:e})}))),s.createElement("p",{className:"messages-number-view"},s.createElement("label",{htmlFor:"messages-progress"},"Vous avez vu ",p.length," messages sur ",a.length),s.createElement("progress",{id:"messages-progress",className:"messages-progress",max:a.length,value:p.length})),a.length>p.length&&s.createElement(E.Z,{position:"center",btnWrapperClass:"mt-30"},s.createElement(h.Z,{type:"button",btnClass:"bg-white",onClickAction:function(){var e=p.length,n=e+i.BN,l=[].concat((0,C.Z)(p),(0,C.Z)((0,f.yQ)(a,e,n)));g(l),t((0,m.Po)({messagesViewed:l}))}},s.createElement("span",{className:"button-text"},"voir plus de messages"),s.createElement("span",{className:"separator"}," "),s.createElement(u.default,{name:"next",iconClass:"current-icon"}))))}function x(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function T(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?x(Object(t),!0).forEach((function(a){(0,n.Z)(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):x(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function O(e){var a=e.page,t=(0,s.useState)(!1),n=(0,l.Z)(t,2),g=n[0],v=n[1],E=(0,r.v9)((function(e){return e.administrator})),f=(0,c.UO)().espaceId,y=(0,r.I0)(),h=a===i.Qv?"".concat(i.JT,"?entity_hash=").concat(f,"&msg_number=2"):"".concat(i.JT,"?entity_hash=").concat(f),b=a===i.Qv?i.hZ:i.Qy,N=(0,o.Z)({key:b,API:h,staleTime:E.isAdmin?500:5e4,cacheTime:E.isAdmin?0:i.Qd,refetchOnMount:E.isAdmin}),_=N.data,w=N.error,C=N.isFetching,Z=(0,o.Z)({key:i.Qo,API:"".concat(i.Y_,"?entity_hash=").concat(f),staleTime:0,cacheTime:0,enabled:E.isAdmin}).data;if((0,s.useEffect)((function(){return E.isAdmin&&y((0,m.sf)({messagesNumber:+(null==Z?void 0:Z.new_message_number)})),null!=_&&_.error&&v(!0),function(){a!==i.Qv&&E.isAdmin&&y((0,m.sf)({messagesNumber:0}))}}),[Z]),C)return s.createElement(d.Z,null);if(w||g)return s.createElement("div",{className:"messages-wrapper"},s.createElement("p",{className:"message-status"},s.createElement(u.default,{name:"cross",iconClass:"message-status-icon error-icon"}),s.createElement("span",null,"Une erreur s'est produite. Nous vous invitons à réessayer plus tard.")));if(_&&null!=_&&_.result){var x,O=_.result,I=null!=E&&E.isAdmin?O.map((function(e){return T(T({},e),{},{isNew:1e3*(null==_?void 0:_.msg_date_last_consult)<1e3*+e.field_message_date_created})})):O;return I&&I.length>8?s.createElement(A,{messages:I}):0===(null==_||null===(x=_.result)||void 0===x?void 0:x.length)||0===(null==I?void 0:I.length)?s.createElement(p,null):s.createElement("div",{className:"messages-wrapper"},s.createElement("ul",{className:"messages-list","data-testid":"messagesList"},I.map((function(e){return s.createElement(k,{key:null==e?void 0:e.message_id,message:e})}))))}return s.createElement("div",{className:"messages-wrapper"},s.createElement(d.Z,null))}},1480:function(e,a,t){t.d(a,{Z:function(){return s}});var n=t(3607),l=t(7294);function s(){return l.createElement("div",{className:"image-preview-placeholder"},l.createElement("span",null,"Photo"),l.createElement("div",{className:"image-preview"},l.createElement("img",{alt:"",className:"image-preview-image",width:"200",height:"200",src:n.Z})))}},1935:function(e,a,t){t.d(a,{Z:function(){return r}});var n=t(4184),l=t.n(n),s=t(7294);function r(e){var a=e.position,t=e.children,n=e.btnWrapperClass;return s.createElement("div",{className:l()("buttons-wrapper",a,n)},t)}},5320:function(e,a,t){var n=t(9669),l=t.n(n),s=(t(7294),t(8767)),r={headers:{"Content-Type":"application/json"},withCredentials:!0,credentials:"include"};a.Z=function(e){var a=(0,s.useMutation)((function(a){var t=a.data,n=a.apiUrl,s=a.options,c=void 0===s?e||r:s;return l().post(n,t,c)})),t=a.data,n=a.error,c=(a.isError,a.isIdle,a.isLoading),i=(a.isPaused,a.isSuccess),m=a.mutate;a.mutateAsync,a.reset,a.status;return{mutate:m,isSuccess:i,data:t,isLoading:c,error:n}}}}]);