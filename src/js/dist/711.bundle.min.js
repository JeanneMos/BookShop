"use strict";(self.webpackChunkespace_souvenir=self.webpackChunkespace_souvenir||[]).push([[711],{2816:function(e,r,t){t.d(r,{Z:function(){return s}});var n=t(5697),a=t.n(n),i=t(7294);function s(e){var r=e.children,t=e.type,n=void 0===t?"button":t,a=e.disabled,s=e.btnClass,l=e.onClickAction,o=e.dataTestid,u=e.ariaLabel;return i.createElement("button",{"data-testid":o,disabled:a,type:"submit"===n?"submit":"button",className:s,onClick:l,"aria-label":u||null},r)}s.defaultProps={type:"button",btnClass:null},s.propTypes={type:a().string,children:a().node.isRequired,btnClass:a().string}},1325:function(e,r,t){var n=t(4184),a=t.n(n),i=t(7294),s=t(7762),l=t(1295),o=i.memo((function(e){var r=e.id,t=e.name,n=e.imageName,o=e.labelText,u=e.labelImage,c=e.type,d=e.value,m=e.autocomplete,p=e.min,f=e.max,v=e.checked,b=e.inputClass,g=e.wrapperClass,h=e.onInputChange,y=e.onInputBlur,w=e.inputPlaceholder,E=e.error,Z=e.displayErrorMessage,O=void 0===Z||Z,C=e.isRequired,k=e.disabled,j=e.readOnly,S=void 0!==j&&j,_=e.ariaDescription,q=encodeURIComponent((0,s.renderToStaticMarkup)(i.createElement(l.default,{name:"cross-red",iconClass:"input-error-icon"}))),N='url("data:image/svg+xml,'.concat(q,'")'),x=!C&&i.createElement("span",{className:"optional-label"}," (facultatif)");return i.createElement("div",{className:a()("input-wrapper",g)},!u&&"checkbox"!==c&&i.createElement("label",{htmlFor:r,className:a()("label",{"label-error":E})},o,x),i.createElement("input",{id:r,type:c,name:t,readOnly:S,"data-imagename":n,className:a()("input",{"input-error":E,inputClass:b}),style:{backgroundImage:E?N:"none"},value:d,min:p,autoComplete:m||null,maxLength:f||null,disabled:k,required:C,"aria-required":C,"aria-describedby":E?"error-".concat(r," ").concat(_):_,"aria-invalid":!!E&&"true",onChange:h,onBlur:y,checked:"radio"===c?v:null,placeholder:w||""}),u&&i.createElement("label",{htmlFor:r,className:a()("label",{"label-error":E})},i.createElement("img",{src:u,className:"label-image",alt:"",width:"150"})),"checkbox"===c&&i.createElement("label",{htmlFor:r,className:a()("label",{"label-error":E})},o),E&&O&&i.createElement("p",{className:"error-message",id:"error-".concat(r),"aria-live":"polite"},E))}));r.Z=o},1711:function(e,r,t){t.d(r,{Z:function(){return Z}});var n=t(5861),a=t(885),i=t(7757),s=t.n(i),l=t(7294),o=t(5998),u=t(6974),c=t(2849),d=t(9973),m=t(2791),p=t(1363),f=t(6006),v=t(5320),b=t(2816),g=t(1295),h=t(4421),y=t(1325),w={username:"",password:""},E={username:{pattern:{value:/^([^<>()[\],"])+$/,message:"Merci de renseigner votre identifiant"},isRequired:!0,required:"Merci de renseigner votre identifiant"},password:{isRequired:!0,required:"Merci de renseigner votre mot de passe"}};function Z(){var e=(0,u.UO)(),r=(0,l.useState)(!1),t=(0,a.Z)(r,2),i=t[0],Z=t[1],O=(0,l.useState)(null),C=(0,a.Z)(O,2),k=C[0],j=C[1],S=(0,o.v9)((function(e){return e.administrator})),_=(0,o.v9)((function(e){return e.modal})),q=(0,o.I0)(),N=(0,f.Z)({initialFormState:w,validationValues:E}),x=N.inputValues,P=N.changeHandler,M=N.errorHandler,I=N.submitErrorsHandler,R=N.errors,V=(N.isValid,(0,l.useRef)(null)),T=(0,v.Z)(),B=function(){var r=(0,n.Z)(s().mark((function r(t){var i,l;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(t.preventDefault(),0===Object.keys(R).length)if((i=Object.entries(x).filter((function(e){var r=(0,a.Z)(e,2),t=r[0],n=r[1];return E[t].isRequired&&""===n})).map((function(e){return(0,a.Z)(e,1)[0]}))).length)I(i);else{l={username:x.username,password:x.password};try{Z(!0),T.mutate({data:l,apiUrl:c.Bn},{onSuccess:function(){var r=(0,n.Z)(s().mark((function r(t){var n,a,i,l,o,u,c,f;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t.data.code||"string"==typeof t.data?(j("Merci de vérifier vos identifiants"),Z(!1)):(j(null),n=t.data,a=n.field_user_civility,i=n.field_user_surname,l=n.field_user_name,o=n.field_user_email,u=n.field_user_phone,c=n.user_gp_entity,f={isLogged:!0,lastName:i,firstName:l,email:o,phone:u,civility:a,gp_entities:c},q((0,d.nD)()),q((0,d.n0)({user:f})),(0,p.B)(c).length&&e&&q((0,d.Vy)({isAdmin:(0,p.B)(c).includes(e.espaceId)})),Z(!1),_.isOpen&&q((0,m.VX)()),S.isAdmin&&window.location.reload());case 1:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),onError:function(){Z(!1),j("Merci de vérifier vos identifiants")}})}catch(e){Z(!1),j(null),console.error(e)}}case 3:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}();return l.createElement(l.Fragment,null,l.createElement("p",{className:"wrong-credentials-message"},k),l.createElement("form",{ref:V,noValidate:!0,id:"user-login-form",onSubmit:B},l.createElement(y.Z,{id:"username",name:"username",labelText:"E-mail",type:"text",autocomplete:"username",value:x.username,onInputChange:P,onInputBlur:M,error:R.username,isRequired:!0}),l.createElement(y.Z,{id:"password",name:"password",labelText:"Mot de passe",type:"password",autocomplete:"current-password",value:x.password,onInputChange:P,onInputBlur:M,error:R.password,isRequired:!0}),l.createElement("input",{type:"hidden",name:"form_id",value:"user_login_form"}),l.createElement("input",{type:"hidden",name:"op",value:"se connecter"}),l.createElement("div",{className:"button-loader-wrapper"},l.createElement(b.Z,{type:"submit",btnClass:"bg-current center"},l.createElement("span",{className:"button-text"},"Se connecter"),l.createElement("span",{className:"separator"}," "),l.createElement(g.default,{name:"next",iconClass:"white-icon"})),i&&l.createElement(h.Z,null)),l.createElement(b.Z,{btnClass:"forgot-password-link bg-transparent center",onClickAction:function(){q((0,m.VX)()),q((0,m.bz)({theme:"dark",hasCloseButton:!0,modalType:"ForgotPasswordModal"}))}},"Mot de passe oublié?")))}},6006:function(e,r,t){t.d(r,{Z:function(){return d}});var n=t(1002),a=t(4925),i=t(4942),s=t(885),l=t(7294);function o(e){var r=function(e,r){if("object"!==(0,n.Z)(e)||null===e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var a=t.call(e,r||"default");if("object"!==(0,n.Z)(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===(0,n.Z)(r)?r:String(r)}function u(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function c(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?u(Object(t),!0).forEach((function(r){(0,i.Z)(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):u(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function d(e){var r=e.initialFormState,t=e.validationValues,n=(0,l.useState)(r),u=(0,s.Z)(n,2),d=u[0],m=u[1],p=(0,l.useState)({}),f=(0,s.Z)(p,2),v=f[0],b=f[1],g=(0,l.useState)(!0),h=(0,s.Z)(g,2),y=h[0],w=h[1],E=function(e){if(""!==e.value){var r=t[e.name].pattern,n=t[e.name].patterns;if(null!=r&&r.value&&!RegExp(r.value).test(e.value))return null==r?void 0:r.message;if(n){var a=n.map((function(r){if(r.value&&!RegExp(r.value).test(e.value))return r.name})),i=a.filter((function(e){return!!e}));return i.length?i:null}return null}return null!==e.getAttribute("required")&&""===e.value?t[e.name].required:null};return{inputValues:d,changeHandler:function(e){var r=e.target,t=c(c({},d),{},(0,i.Z)({},r.name,r.value));if(!E(r)&&Object.prototype.hasOwnProperty.call(v,r.name)){var n=r.name,s=(v[n],(0,a.Z)(v,[n].map(o)));b(s)}0===Object.keys(v).length&&w(!0),m(t)},errorHandler:function(e){var r=e.target,t={};E(r)?(w(!1),t=c(c({},v),{},(0,i.Z)({},r.name,E(r)))):t=c({},v),b(t)},submitErrorsHandler:function(e){var r={},n=null;e.forEach((function(e){var a;e.requiredMessage?n=e.requiredMessage:n=null===(a=t[e])||void 0===a?void 0:a.required;e.requiredMessage?r[e.name]=n:r[e]=n})),w(!1),b(r)},errors:v,isValid:y}}},5320:function(e,r,t){var n=t(9669),a=t.n(n),i=(t(7294),t(8767)),s={headers:{"Content-Type":"application/json"},withCredentials:!0,credentials:"include"};r.Z=function(e){var r=(0,i.useMutation)((function(r){var t=r.data,n=r.apiUrl,i=r.options,l=void 0===i?e||s:i;return a().post(n,t,l)})),t=r.data,n=r.error,l=(r.isError,r.isIdle,r.isLoading),o=(r.isPaused,r.isSuccess),u=r.mutate;r.mutateAsync,r.reset,r.status;return{mutate:u,isSuccess:o,data:t,isLoading:l,error:n}}}}]);