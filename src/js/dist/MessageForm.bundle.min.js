"use strict";(self.webpackChunkespace_souvenir=self.webpackChunkespace_souvenir||[]).push([[170],{1325:function(e,t,a){var r=a(4184),n=a.n(r),s=a(7294),l=a(7762),i=a(1295),o=s.memo((function(e){var t=e.id,a=e.name,r=e.imageName,o=e.labelText,u=e.labelImage,m=e.type,c=e.value,p=e.autocomplete,d=e.min,g=e.max,f=e.checked,v=e.inputClass,b=e.wrapperClass,h=e.onInputChange,E=e.onInputBlur,N=e.inputPlaceholder,y=e.error,P=e.displayErrorMessage,Z=void 0===P||P,C=e.isRequired,q=e.disabled,w=e.readOnly,O=void 0!==w&&w,x=e.ariaDescription,M=encodeURIComponent((0,l.renderToStaticMarkup)(s.createElement(i.default,{name:"cross-red",iconClass:"input-error-icon"}))),S='url("data:image/svg+xml,'.concat(M,'")'),R=!C&&s.createElement("span",{className:"optional-label"}," (facultatif)");return s.createElement("div",{className:n()("input-wrapper",b)},!u&&"checkbox"!==m&&s.createElement("label",{htmlFor:t,className:n()("label",{"label-error":y})},o,R),s.createElement("input",{id:t,type:m,name:a,readOnly:O,"data-imagename":r,className:n()("input",{"input-error":y,inputClass:v}),style:{backgroundImage:y?S:"none"},value:c,min:d,autoComplete:p||null,maxLength:g||null,disabled:q,required:C,"aria-required":C,"aria-describedby":y?"error-".concat(t," ").concat(x):x,"aria-invalid":!!y&&"true",onChange:h,onBlur:E,checked:"radio"===m?f:null,placeholder:N||""}),u&&s.createElement("label",{htmlFor:t,className:n()("label",{"label-error":y})},s.createElement("img",{src:u,className:"label-image",alt:"",width:"150"})),"checkbox"===m&&s.createElement("label",{htmlFor:t,className:n()("label",{"label-error":y})},o),y&&Z&&s.createElement("p",{className:"error-message",id:"error-".concat(t),"aria-live":"polite"},y))}));t.Z=o},3141:function(e,t,a){var r=a(885),n=a(4184),s=a.n(n),l=a(7294),i=l.memo((function(e){var t=e.id,a=e.name,n=e.labelText,i=e.labelHidden,o=e.value,u=e.min,m=e.max,c=e.wrapperClass,p=e.onInputChange,d=e.onInputBlur,g=e.inputPlaceholder,f=e.error,v=e.isRequired,b=void 0!==v&&v,h=e.disabled,E=void 0!==h&&h,N=(0,l.useState)(null),y=(0,r.Z)(N,2),P=y[0],Z=y[1],C=(0,l.useState)(m),q=(0,r.Z)(C,2),w=q[0],O=q[1];(0,l.useEffect)((function(){Z("".concat(a,"-requirement")),f&&Z("".concat(P," error-").concat(t))}),[f]);return l.createElement("div",{className:s()("input-wrapper",c)},l.createElement("label",{htmlFor:t,className:s()("label",{"label-error":f,"sr-only":i})},n),l.createElement("textarea",{id:t,name:a,className:s()("textarea",{"input-error":f}),value:o,min:u,maxLength:m,rows:10,disabled:E,required:b,"aria-required":b,"aria-describedby":P,onChange:function(e){if(p(e),m){var t=Number(m)-e.target.value.length;O(t)}},onBlur:d,placeholder:g||""}),f&&l.createElement("p",{className:"error-message",id:"error-".concat(t),"aria-live":"polite"},f),m&&l.createElement("p",{className:"message-photo-requirements","data-testid":"caractersCount",id:"".concat(a,"-requirement")},w," caractères restants."))}));t.Z=i},6719:function(e,t,a){a.r(t),a.d(t,{default:function(){return R}});var r=a(885),n=a(7294),s=a(8767),l=a(5998),i=a(6974),o=a(2849),u=a(4470),m=a(2791),c=a(1935),p=a(324),d=a(7959),g=a(6006),f=a(5320),v=a(2816),b=a(1295),h=a(4421),E=a(5533),N=a(2554),y=a(2982),P=a(8005),Z=a.n(P),C=a(5697),q=a.n(C);function w(e){var t=e.numberOfPhotos,a=e.dispatchCbAction,s=e.uploadedPhotos,l=(0,n.useState)(s||[]),i=(0,r.Z)(l,2),o=i[0],u=i[1],m=(0,n.useState)(null),c=(0,r.Z)(m,2),p=c[0],d=c[1];return{handleCompressedUpload:function(e){var r=e.target.files[0],n=o.map((function(e){return e.name}));n.length>=t?d("Vous ne pouvez pas ajouter plus de ".concat(t," photos")):r.size>=2097152?d("Votre photo ne peut pas dépasser 2 Mo"):"image/jpeg"===r.type||"image/png"===r.type||"image/bmp"===r.type?(0===n.length||n.length>0&&!n.includes(r.name))&&(d(null),new(Z())(r,{quality:.8,success:function(e){u([].concat((0,y.Z)(o),[e])),a&&a([].concat((0,y.Z)(o),[e]))},error:function(e){console.error(e)}})):d("Vous pouvez télécharge des photo au format PNG/JPG/JPEG/BMP uniquement")},compressedFiles:o,handleDeletePhoto:function(e){var t=o.filter((function(t){return t.name!==e}));u(t),d(null),a&&a(t)},errorMessage:p}}w.defaultProps={numberOfPhotos:1},w.propTypes={name:q().string.isRequired,numberOfPhotos:q().number};var O=a(1325),x=a(3141),M={firstName:"",lastName:"",email:"",message:"",photo:"",eventsOptin:""},S={firstName:{pattern:{value:/^([0-9a-zA-Z\u00C0-\u00FF ',-])+$/,message:"Merci de renseigner votre prénom"},isRequired:!0,required:"Merci de renseigner votre prénom"},lastName:{pattern:{value:/^([0-9a-zA-Z\u00C0-\u00FF ',-])+$/,message:"Merci de renseigner votre nom de famille"},isRequired:!0,required:"Merci de renseigner votre nom de famille"},email:{pattern:{value:/^(([^<>()[\].,;:\s@"]+(\.[^<>()[\].,;:\s@"]+)*)|(".+"))@(([^<>()[\].,;:\s@"]+\.)+[^<>()[\].,;:\s@"]{2,})$/,message:"Merci de renseigner une adresse email valide (p.e. email@domain.com)"},isRequired:!0,required:"Merci de renseigner votre adresse email"},message:{isRequired:!0,required:"Merci de remplir le texte du message"},photo:{isRequired:!1},eventsOptin:{isRequired:!1}};function R(e){var t=e.reference,a=e.closeForm,y=(0,l.v9)((function(e){return e.messages})),P=(0,n.useState)(null),Z=(0,r.Z)(P,2),C=Z[0],q=Z[1],R=(0,n.useState)(null),j=(0,r.Z)(R,2),k=j[0],F=j[1],I=(0,l.I0)(),V=(0,i.UO)(),_=(0,f.Z)(),B=(0,s.useQueryClient)(),T=(0,n.useRef)(),z=(0,g.Z)({initialFormState:M,validationValues:S}),D=z.inputValues,U=z.changeHandler,A=z.errorHandler,G=z.submitErrorsHandler,L=z.errors,H=z.isValid,J=w({numberOfPhotos:3,dispatchCbAction:function(e){if((0,p.yD)(e))I((0,u.nM)());else{var t={url:window.URL.createObjectURL(e[0]),name:e[0].name};I((0,u.tR)({messagePictures:[t],customMessagePicture:!0})),F(e[0])}}}),Q=J.handleCompressedUpload,$=(J.compressedFiles,J.handleDeletePhoto),K=J.errorMessage;var W=function(e){e.preventDefault();var t=Object.keys(L);if(!H&&T.current&&(0,d.Z)(T.current),0===t.length){var n=Object.entries(D).filter((function(e){var t=(0,r.Z)(e,2),a=t[0],n=t[1];return S[a].isRequired&&""===n})).map((function(e){return(0,r.Z)(e,1)[0]}));if(n.length)G(n),T.current&&(0,d.Z)(T.current);else{var s,l=new FormData;if(null!=k&&k.name&&null!=y&&y.customMessagePicture&&l.append("file",k,null==k?void 0:k.name),(null==y||!y.customMessagePicture)&&null!=y&&y.messagePictures)l.append("field_message_banner",null==y||null===(s=y.messagePictures[0])||void 0===s?void 0:s.name);l.append("field_message_name",null==D?void 0:D.firstName),l.append("field_message_surname",null==D?void 0:D.lastName),l.append("field_message_email",null==D?void 0:D.email),l.append("field_message_texte",null==D?void 0:D.message),l.append("field_message_status",!0),l.append("entity_hash",V.espaceId),_.mutate({data:l,apiUrl:o.ML},{onSuccess:function(e){200===e.data.status?setTimeout((function(){B.refetchQueries([o.Qy]),B.refetchQueries([o.hZ]),B.refetchQueries([o.Qo]),a({messageSent:!0})}),1e3):q("Une erreur s'est produite. Merci de réessayer plus tard.")},onError:function(e){q("Une erreur s'est produite. Merci de réessayer plus tard.")}})}}};return(0,n.useEffect)((function(){return function(){return $()}}),[]),n.createElement(n.Fragment,null,n.createElement("h2",{className:"content-heading-2"},"Ecrire un message"),n.createElement("div",{className:"messages-form-wrapper"},n.createElement("form",{noValidate:!0,ref:t,onSubmit:W,"data-testid":"messagesForm",className:"messages-form"},n.createElement("h3",{className:"messages-form-title"},"Quel message souhaitez-vous transmettre ?"),!H&&n.createElement("p",{className:"sr-only",tabIndex:0},"Merci de corriger les erreurs"),C&&n.createElement("p",{className:"upload-error-message"},C),n.createElement(O.Z,{id:"lastName",name:"lastName",labelText:"Votre nom",type:"text",isRequired:!0,value:D.lastName,inputPlaceholder:"Nom",onInputChange:U,onInputBlur:A,error:L.lastName}),n.createElement(O.Z,{id:"firstName",name:"firstName",labelText:"Votre prénom",type:"text",isRequired:!0,value:D.firstName,inputPlaceholder:"Prénom",onInputChange:U,onInputBlur:A,error:L.firstName}),n.createElement(O.Z,{id:"email",name:"email",labelText:"Votre email",type:"email",isRequired:!0,value:D.email,inputPlaceholder:"Email",onInputChange:U,onInputBlur:A,error:L.email}),n.createElement("fieldset",{className:"message-photo-upload"},n.createElement("legend",null,"Souhaitez-vous ajouter une photo ?",n.createElement("span",{className:"optional-label"}," (facultatif)"),n.createElement("span",{className:"message-photo-requirements"}," PNG/JPG/JPEG/BMP - 2 Mo maximum")),K&&n.createElement("p",{className:"upload-error-message"},K),!(null!=y&&y.messagePictures)&&n.createElement(n.Fragment,null,n.createElement(N.Z,{inputName:"message-photos",handleCompressedUpload:Q,btnClass:"bg-current",describedBy:"".concat(K?"error-message":"message-photo max-photo-number max-photo-size")}),n.createElement(v.Z,{type:"button",btnClass:"bg-white message-photo-button",onClickAction:function(){I((0,m.bz)({theme:"dark",hasCloseButton:!0,modalType:"MessagePictureHeroModal"}))}},n.createElement(b.default,{name:"picture",iconClass:"current-icon"}),n.createElement("span",{className:"separator"}," "),n.createElement("span",{className:"button-text"},"Choisir une photo"))),(null==y?void 0:y.messagePictures)&&y.messagePictures.map((function(e){return n.createElement(E.Z,{key:"string"==typeof e?e:e.name,source:"string"==typeof e?e:e.url,imgName:e.name,imgSize:e.size,deletePhoto:$,modal:!1})}))),n.createElement(x.Z,{labelText:"Votre message",isRequired:!0,id:"message",name:"message",max:1e3,value:D.message,inputPlaceholder:"Votre message",onInputChange:U,onInputBlur:A,error:L.message}),n.createElement(O.Z,{type:"checkbox",id:"eventsOptin",name:"eventsOptin",isRequired:!1,labelText:"Je souhaite être alerté des évènements privés ajoutés dans cet Espace Souvenirs"}),n.createElement(c.Z,{position:"right"},n.createElement("div",{className:"button-loader-wrapper"},n.createElement(v.Z,{type:"button",btnClass:"bg-transparent",onClickAction:function(){a({messageSent:!1})}},"Annuler"),n.createElement(v.Z,{type:"submit",disabled:null==_?void 0:_.isLoading,btnClass:"bg-current",dataTestid:"submitMessageForm",onClickAction:W},n.createElement("span",{className:"button-text"},"Envoyer un message"),n.createElement("span",{className:"separator"}," "),n.createElement(b.default,{name:"next",iconClass:"white-icon"})),(null==_?void 0:_.isLoading)&&n.createElement(h.Z,{position:"relative"}))))))}},5533:function(e,t,a){a.d(t,{Z:function(){return m}});var r=a(4184),n=a.n(r),s=a(5697),l=a.n(s),i=a(7294),o=a(2816),u=a(1295);function m(e){var t=e.source,a=e.imgName,r=e.imgSize,s=e.deletePhoto,l=e.modal,m=r?Math.ceil(r/1e3):null;return i.createElement("div",{className:n()("image-preview-wrapper",l&&"image-preview-wrapper--modal")},l&&i.createElement("span",null,"Photo"),i.createElement("div",{className:"image-preview"},i.createElement("img",{alt:"",className:"image-preview-image",width:"200",height:"200",src:t})),a&&i.createElement("span",{className:"preview-description--bold"},a),m&&i.createElement("span",{className:"preview-description"},m,"Kb"),i.createElement(o.Z,{ariaLabel:"supprimer ".concat(a),type:"button",btnClass:"delete-image-button",onClickAction:function(){s(a)}},i.createElement(u.default,{name:"delete",iconClass:"delete-image-icon"})))}m.propTypes={source:l().string.isRequired,imgName:l().string,deletePhoto:l().func.isRequired,imgSize:l().number,modal:l().bool}},2554:function(e,t,a){a.d(t,{Z:function(){return i}});var r=a(4184),n=a.n(r),s=a(7294),l=a(1295);function i(e){var t=e.inputName,a=e.handleCompressedUpload,r=e.hasImageRequirement,i=e.btnClass,o=e.inputDisabled,u=void 0!==o&&o,m=e.describedBy,c=e.inputFile;return s.createElement("div",{className:"input-file-wrapper"},s.createElement("input",{accept:"image/png, image/jpeg, image/jpg",type:"file",id:t,ref:c,name:t,onChange:a,disabled:u,"aria-describedby":"input-file-description ".concat(m)}),s.createElement("label",{htmlFor:t,className:n()("file-input-label",i)},s.createElement(l.default,{name:"upload",iconClass:i&&"bg-current"===i?"white-icon":"current-icon"}),s.createElement("span",{className:"separator"}," "),"Déposer votre photo"),r&&s.createElement("p",{id:"input-file-description",className:"input-file-description"},"Les formats supportés : PNG/JPG/JPEG/BMP - 2 Mo maximum"))}},6006:function(e,t,a){a.d(t,{Z:function(){return c}});var r=a(1002),n=a(4925),s=a(4942),l=a(885),i=a(7294);function o(e){var t=function(e,t){if("object"!==(0,r.Z)(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var n=a.call(e,t||"default");if("object"!==(0,r.Z)(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"===(0,r.Z)(t)?t:String(t)}function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){(0,s.Z)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e){var t=e.initialFormState,a=e.validationValues,r=(0,i.useState)(t),u=(0,l.Z)(r,2),c=u[0],p=u[1],d=(0,i.useState)({}),g=(0,l.Z)(d,2),f=g[0],v=g[1],b=(0,i.useState)(!0),h=(0,l.Z)(b,2),E=h[0],N=h[1],y=function(e){if(""!==e.value){var t=a[e.name].pattern,r=a[e.name].patterns;if(null!=t&&t.value&&!RegExp(t.value).test(e.value))return null==t?void 0:t.message;if(r){var n=r.map((function(t){if(t.value&&!RegExp(t.value).test(e.value))return t.name})),s=n.filter((function(e){return!!e}));return s.length?s:null}return null}return null!==e.getAttribute("required")&&""===e.value?a[e.name].required:null};return{inputValues:c,changeHandler:function(e){var t=e.target,a=m(m({},c),{},(0,s.Z)({},t.name,t.value));if(!y(t)&&Object.prototype.hasOwnProperty.call(f,t.name)){var r=t.name,l=(f[r],(0,n.Z)(f,[r].map(o)));v(l)}0===Object.keys(f).length&&N(!0),p(a)},errorHandler:function(e){var t=e.target,a={};y(t)?(N(!1),a=m(m({},f),{},(0,s.Z)({},t.name,y(t)))):a=m({},f),v(a)},submitErrorsHandler:function(e){var t={},r=null;e.forEach((function(e){var n;e.requiredMessage?r=e.requiredMessage:r=null===(n=a[e])||void 0===n?void 0:n.required;e.requiredMessage?t[e.name]=r:t[e]=r})),N(!1),v(t)},errors:f,isValid:E}}}}]);