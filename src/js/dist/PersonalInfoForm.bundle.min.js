"use strict";(self.webpackChunkespace_souvenir=self.webpackChunkespace_souvenir||[]).push([[270],{8416:function(e,r,a){a.r(r),a.d(r,{default:function(){return Z}});var n=a(4942),t=a(2982),s=a(885),i=a(7294),l=a(5998),o=a(2849),u=a(9973),c=a(5626),p=a(1935),d=a(7959),m=a(6006),v=a(5320),f=a(2816),w=a(1295),b=a(4421),g=a(1325),h=a(2558);function E(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,n)}return a}function _(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?E(Object(a),!0).forEach((function(r){(0,n.Z)(e,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):E(Object(a)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))}))}return e}var y={surname:{pattern:{value:/^([a-zA-Z\u00C0-\u00FF '-])+$/,message:"Merci de renseigner votre nom de famille correct"},isRequired:!0,required:"Merci de renseigner votre nom de famille"},name:{pattern:{value:/^([a-zA-Z\u00C0-\u00FF '-])+$/,message:"Merci de renseigner votre prénom"},isRequired:!0,required:"Merci de renseigner votre prénom"},email:{isRequired:!0,required:"Merci de renseigner votre email"},phone:{pattern:{value:/^([0-9])+$/,message:"Merci de renseigner le numéro de téléphone au format requis (ex. 0799999999)"},isRequired:!1},current_password:{isRequired:!1},repeat_new_password:{isRequired:!1},new_password:{isRequired:!1,patterns:[{name:"patternNumber",value:/[0-9]/},{name:"patternLength",value:/^[\s\S]{8,}$/},{name:"patternMaj",value:/[A-Z]/},{name:"patternSpecialChar",value:/[ !"#$%&'()*+,\-./:;<=>?@[\\\]^_`{|}~]/}]}};function Z(e){var r,a,n,E,Z,O=e.closeForm,N=(0,l.v9)((function(e){return e.administrator})),C=(0,l.v9)((function(e){return e.globalInfo})),q=(0,l.I0)(),j=(0,i.useState)(""),P=(0,s.Z)(j,2),I=P[0],M=P[1],S=(0,i.useState)(!1),x=(0,s.Z)(S,2),k=x[0],R=x[1],F=(0,i.useRef)(null),T={surname:(null===(r=N.currentUser)||void 0===r||null===(a=r.lastName)||void 0===a?void 0:a.toUpperCase())||"",name:(null===(n=N.currentUser)||void 0===n?void 0:n.firstName)||"",phone:(null===(E=N.currentUser)||void 0===E?void 0:E.phone)||"",email:(null===(Z=N.currentUser)||void 0===Z?void 0:Z.email)||"",current_password:"",new_password:"",repeat_new_password:""},V=(0,m.Z)({initialFormState:T,validationValues:y}),U=V.inputValues,D=V.changeHandler,A=V.errorHandler,H=V.submitErrorsHandler,B=V.errors,L=V.isValid,z=(0,v.Z)(),$=(0,i.useRef)();return i.createElement(i.Fragment,null,I&&i.createElement("p",{ref:F,className:"message-status mb-40"},i.createElement(w.default,{name:"cross",iconClass:"message-status-icon error-icon"}),i.createElement("span",null,I)),i.createElement("h2",{className:"content-heading-2"},"Modification des informations personnelles"),!L&&i.createElement("p",{className:"sr-only",tabIndex:0,ref:$},"Merci de corriger les erreurs"),i.createElement("form",{noValidate:!0,onSubmit:function(e){e.preventDefault();var r=Object.keys(B);if(!L&&$.current&&(0,d.Z)($.current),0===r.length){var a=Object.entries(U).filter((function(e){var r=(0,s.Z)(e,2),a=r[0],n=r[1];return y[a].isRequired&&""===n})).map((function(e){return(0,s.Z)(e,1)[0]}));if(a.length)H(a);else if(""!==U.new_password&&""===U.repeat_new_password)H([].concat((0,t.Z)(a),[{name:"repeat_new_password",requiredMessage:"Merci de confirmer votre mot de passe"}]));else if(""!==U.new_password&&U.repeat_new_password!==U.new_password)H([].concat((0,t.Z)(a),[{name:"repeat_new_password",requiredMessage:"Les mots de passes ne sont pas identiques"}]));else if(""!==U.new_password&&""===U.current_password)H([].concat((0,t.Z)(a),[{name:"current_password",requiredMessage:"Merci de confirmer votre mot de passe actuel"}]));else{var n,i,l={surname:U.surname,name:U.name,phone:U.phone,mail:null===(n=N.currentUser)||void 0===n?void 0:n.email,brand:(null==C||null===(i=C.marque)||void 0===i?void 0:i.name)||"pfg",current_password:U.current_password,new_password:U.new_password,repeat_new_password:U.repeat_new_password};try{R(!0),z.mutate({data:l,apiUrl:o.j5},{onSuccess:function(e){var r=e.data;if(null!=r&&r.status&&200===(null==r?void 0:r.status)){var a=r.field_user_surname,n=r.field_user_name,t=r.field_user_phone,s=_(_({},null==N?void 0:N.currentUser),{},{lastName:a,firstName:n,phone:t});q((0,u.n0)({user:s})),N.isAdmin&&q((0,c.Rh)({firstName:s.firstName,lastName:s.lastName})),q((0,u.lF)({isEditingPersonalInfo:!1,isEditingAdministator:!0})),O({userUpdated:!0})}else R(!1),M("Une erreur s'est produite. Veuillez reprendre ultérieurement."),(null==F?void 0:F.current)&&(0,d.Z)(F.current)},onError:function(){R(!1),M("Une erreur s'est produite. Veuillez reprendre ultérieurement."),(null==F?void 0:F.current)&&(0,d.Z)(F.current)}})}catch(e){R(!1),M("Une erreur s'est produite. Veuillez reprendre ultérieurement."),(null==F?void 0:F.current)&&(0,d.Z)(F.current)}}}},className:"personal-info-form"},i.createElement("fieldset",{"aria-describedby":"personal-info"},i.createElement("p",{className:"fieldset-description",id:"personal-info"},"Coordonnées"),i.createElement(g.Z,{id:"surname",name:"surname",labelText:"Nom",type:"text",isRequired:!0,inputClass:"uppercase",autocomplete:"family-name",value:U.surname,inputPlaceholder:"Nom",onInputChange:D,onInputBlur:A,error:B.surname}),i.createElement(g.Z,{id:"name",name:"name",labelText:"Prénom",type:"text",isRequired:!0,autocomplete:"given-name",value:U.name,inputPlaceholder:"Prénom",onInputChange:D,onInputBlur:A,error:B.name}),i.createElement(g.Z,{id:"email",name:"email",labelText:"Email",type:"email",readOnly:!0,isRequired:!0,autocomplete:"email",value:U.email,inputPlaceholder:"Email",onInputChange:D,onInputBlur:A,error:B.email}),i.createElement(g.Z,{id:"phone",name:"phone",labelText:"Téléphone",type:"tel",max:14,autocomplete:"tel",value:U.phone,inputPlaceholder:"Téléphone",onInputChange:D,onInputBlur:A,error:B.phone}),i.createElement(g.Z,{type:"checkbox",id:"eventsOptin",name:"eventsOptin",wrapperClass:"mt-30",isRequired:!1,labelText:"Je souhaite être alerté des évènements privés ajoutés dans cet Espace Souvenirs"})),i.createElement("fieldset",{"aria-describedby":"password-info",className:"mt-30"},i.createElement("p",{className:"fieldset-description",id:"password-info"},"Mot de passe"),i.createElement(h.Z,{includeCurrentPassword:!0,inputValues:U,changeHandler:D,errorHandler:A,errors:B})),i.createElement(p.Z,{position:"right",btnWrapperClass:"mt-30"},i.createElement(f.Z,{type:"button",btnClass:"bg-transparent",onClickAction:function(){q((0,u.lF)({isEditingPersonalInfo:!1,isEditingAdministator:!0}))}},"Annuler"),i.createElement("div",{className:"button-loader-wrapper"},i.createElement(f.Z,{type:"submit",btnClass:"bg-current",dataTestid:"submitInfosForm"},i.createElement("span",{className:"button-text"},"Entregistrer")),k&&i.createElement(b.Z,{position:"relative"})))))}},1325:function(e,r,a){var n=a(4184),t=a.n(n),s=a(7294),i=a(7762),l=a(1295),o=s.memo((function(e){var r=e.id,a=e.name,n=e.imageName,o=e.labelText,u=e.labelImage,c=e.type,p=e.value,d=e.autocomplete,m=e.min,v=e.max,f=e.checked,w=e.inputClass,b=e.wrapperClass,g=e.onInputChange,h=e.onInputBlur,E=e.inputPlaceholder,_=e.error,y=e.displayErrorMessage,Z=void 0===y||y,O=e.isRequired,N=e.disabled,C=e.readOnly,q=void 0!==C&&C,j=e.ariaDescription,P=encodeURIComponent((0,i.renderToStaticMarkup)(s.createElement(l.default,{name:"cross-red",iconClass:"input-error-icon"}))),I='url("data:image/svg+xml,'.concat(P,'")'),M=!O&&s.createElement("span",{className:"optional-label"}," (facultatif)");return s.createElement("div",{className:t()("input-wrapper",b)},!u&&"checkbox"!==c&&s.createElement("label",{htmlFor:r,className:t()("label",{"label-error":_})},o,M),s.createElement("input",{id:r,type:c,name:a,readOnly:q,"data-imagename":n,className:t()("input",{"input-error":_,inputClass:w}),style:{backgroundImage:_?I:"none"},value:p,min:m,autoComplete:d||null,maxLength:v||null,disabled:N,required:O,"aria-required":O,"aria-describedby":_?"error-".concat(r," ").concat(j):j,"aria-invalid":!!_&&"true",onChange:g,onBlur:h,checked:"radio"===c?f:null,placeholder:E||""}),u&&s.createElement("label",{htmlFor:r,className:t()("label",{"label-error":_})},s.createElement("img",{src:u,className:"label-image",alt:"",width:"150"})),"checkbox"===c&&s.createElement("label",{htmlFor:r,className:t()("label",{"label-error":_})},o),_&&Z&&s.createElement("p",{className:"error-message",id:"error-".concat(r),"aria-live":"polite"},_))}));r.Z=o},2558:function(e,r,a){a.d(r,{Z:function(){return c}});var n=a(7294),t=a(4184),s=a.n(t),i=a(1295),l={patternNumber:"Il manque un chiffre",patternLength:"Le mot de passe n'est pas assez long",patternMaj:"Il manque une majuscule",patternSpecialChar:"Il manque un caractère spécial"};function o(e){var r=e.isValid,a=e.error;return n.createElement("span",null,n.createElement(i.default,{name:r?"check":"cross",iconClass:s()("password-validation-icon",r?"green":"red")}),a&&n.createElement("span",{className:"sr-only"},l[a]))}var u=a(1325);function c(e){var r=e.inputValues,a=e.changeHandler,t=e.errorHandler,s=e.errors,i=e.includeCurrentPassword,l=void 0!==i&&i,c=e.requiredNewPassword,p=void 0!==c&&c,d=function(e){var a;return""===r.new_password?null:null!=s&&s.new_password&&0!==(null==s||null===(a=s.new_password)||void 0===a?void 0:a.length)?n.createElement(o,{isValid:!s.new_password.includes(e),error:s.new_password.includes(e)&&e}):n.createElement(o,{isValid:!0})};return n.createElement(n.Fragment,null,l&&n.createElement(u.Z,{id:"current_password",name:"current_password",labelText:"Mot de passe actuel",type:"password",autocomplete:"current-password",value:r.current_password,inputPlaceholder:"Mot de passe actuel",onInputChange:a,onInputBlur:t,error:s.current_password}),n.createElement(u.Z,{id:"new_password",name:"new_password",labelText:"Nouveau mot de passe",type:"password",autocomplete:"new-password",value:r.new_password,inputPlaceholder:"Nouveau mot de passe",onInputChange:function(e){t(e),a(e)},onInputBlur:t,displayErrorMessage:!1,isRequired:p,error:s.new_password,ariaDescription:"new_password_requirement"}),n.createElement(u.Z,{id:"repeat_new_password",name:"repeat_new_password",labelText:"Confirmer votre mot de passe",type:"password",value:r.repeat_new_password,inputPlaceholder:"Confirmer votre mot de passe",onInputChange:a,onInputBlur:t,isRequired:p,error:s.repeat_new_password}),n.createElement("span",{className:"sr-only",id:"new_password_requirement"},"l faut un minimum de 8 caractères avec au moins une majuscule, un chiffre et un caractère spécial."),n.createElement("p",{className:"password-check","aria-live":"polite",id:"error-new_password","aria-relevant":"additions"},n.createElement("span",{"aria-hidden":"true"},"Il faut un minimum de "),n.createElement("span",{className:"password-check-item"},n.createElement("span",{"aria-hidden":"true"},"8 caractères avec au moins")," ",d("patternLength")),n.createElement("span",{className:"password-check-item"},n.createElement("span",{"aria-hidden":"true"},"1 majuscule")," ",d("patternMaj")),n.createElement("span",{className:"password-check-item"},n.createElement("span",{"aria-hidden":"true"},"1 chiffre")," ",d("patternNumber")),n.createElement("span",{className:"password-check-item"},n.createElement("span",{"aria-hidden":"true"},"1 caractère spécial")," ",d("patternSpecialChar"))))}},1935:function(e,r,a){a.d(r,{Z:function(){return i}});var n=a(4184),t=a.n(n),s=a(7294);function i(e){var r=e.position,a=e.children,n=e.btnWrapperClass;return s.createElement("div",{className:t()("buttons-wrapper",r,n)},a)}},6006:function(e,r,a){a.d(r,{Z:function(){return p}});var n=a(1002),t=a(4925),s=a(4942),i=a(885),l=a(7294);function o(e){var r=function(e,r){if("object"!==(0,n.Z)(e)||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var t=a.call(e,r||"default");if("object"!==(0,n.Z)(t))return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(e)}(e,"string");return"symbol"===(0,n.Z)(r)?r:String(r)}function u(e,r){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),a.push.apply(a,n)}return a}function c(e){for(var r=1;r<arguments.length;r++){var a=null!=arguments[r]?arguments[r]:{};r%2?u(Object(a),!0).forEach((function(r){(0,s.Z)(e,r,a[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))}))}return e}function p(e){var r=e.initialFormState,a=e.validationValues,n=(0,l.useState)(r),u=(0,i.Z)(n,2),p=u[0],d=u[1],m=(0,l.useState)({}),v=(0,i.Z)(m,2),f=v[0],w=v[1],b=(0,l.useState)(!0),g=(0,i.Z)(b,2),h=g[0],E=g[1],_=function(e){if(""!==e.value){var r=a[e.name].pattern,n=a[e.name].patterns;if(null!=r&&r.value&&!RegExp(r.value).test(e.value))return null==r?void 0:r.message;if(n){var t=n.map((function(r){if(r.value&&!RegExp(r.value).test(e.value))return r.name})),s=t.filter((function(e){return!!e}));return s.length?s:null}return null}return null!==e.getAttribute("required")&&""===e.value?a[e.name].required:null};return{inputValues:p,changeHandler:function(e){var r=e.target,a=c(c({},p),{},(0,s.Z)({},r.name,r.value));if(!_(r)&&Object.prototype.hasOwnProperty.call(f,r.name)){var n=r.name,i=(f[n],(0,t.Z)(f,[n].map(o)));w(i)}0===Object.keys(f).length&&E(!0),d(a)},errorHandler:function(e){var r=e.target,a={};_(r)?(E(!1),a=c(c({},f),{},(0,s.Z)({},r.name,_(r)))):a=c({},f),w(a)},submitErrorsHandler:function(e){var r={},n=null;e.forEach((function(e){var t;e.requiredMessage?n=e.requiredMessage:n=null===(t=a[e])||void 0===t?void 0:t.required;e.requiredMessage?r[e.name]=n:r[e]=n})),E(!1),w(r)},errors:f,isValid:h}}},5320:function(e,r,a){var n=a(9669),t=a.n(n),s=(a(7294),a(8767)),i={headers:{"Content-Type":"application/json"},withCredentials:!0,credentials:"include"};r.Z=function(e){var r=(0,s.useMutation)((function(r){var a=r.data,n=r.apiUrl,s=r.options,l=void 0===s?e||i:s;return t().post(n,a,l)})),a=r.data,n=r.error,l=(r.isError,r.isIdle,r.isLoading),o=(r.isPaused,r.isSuccess),u=r.mutate;r.mutateAsync,r.reset,r.status;return{mutate:u,isSuccess:o,data:a,isLoading:l,error:n}}}}]);